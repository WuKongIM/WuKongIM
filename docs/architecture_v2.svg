<svg xmlns="http://www.w3.org/2000/svg" width="920" height="720" viewBox="0 0 920 720" style="background-color: #ffffff;">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 L2,3 Z" fill="#94a3b8" />
    </marker>
    <marker id="arrow-dash" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
      <path d="M0,0 L6,2.5 L0,5 L1.5,2.5 Z" fill="#cbd5e1" />
    </marker>
    
    <filter id="soft-shadow" x="-5%" y="-5%" width="110%" height="115%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#64748b" flood-opacity="0.08"/>
    </filter>

    <style>
      .layer { fill: #fafbfc; stroke: #e2e8f0; stroke-width: 1; rx: 12; filter: url(#soft-shadow); }
      .layer-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 13px; font-weight: 600; fill: #64748b; text-anchor: start; letter-spacing: 0.5px; }
      
      .box { stroke-width: 1.5; rx: 8; }
      .box-client { fill: #eff6ff; stroke: #93c5fd; }
      .box-gateway { fill: #fef9c3; stroke: #fcd34d; }
      .box-core { fill: #f1f5f9; stroke: #cbd5e1; }
      .box-cluster { fill: #ecfdf5; stroke: #6ee7b7; }
      .box-storage { fill: #f0fdfa; stroke: #5eead4; }
      
      .title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 12px; font-weight: 600; fill: #1e293b; text-anchor: middle; }
      .label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 10px; fill: #64748b; text-anchor: middle; }
      .sublabel { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 9px; fill: #94a3b8; text-anchor: middle; }
      
      .arrow { stroke: #94a3b8; stroke-width: 1.2; marker-end: url(#arrow); fill: none; }
      .arrow-dash { stroke: #cbd5e1; stroke-width: 1; stroke-dasharray: 4 3; marker-end: url(#arrow-dash); fill: none; }
    </style>
  </defs>

  <!-- Layer 1: Clients -->
  <rect x="20" y="20" width="880" height="95" class="layer"/>
  <text x="40" y="42" class="layer-title">CLIENT LAYER</text>
  
  <rect x="45" y="52" width="100" height="50" class="box box-client"/>
  <text x="95" y="72" class="title">Mobile SDK</text>
  <text x="95" y="86" class="sublabel">Android / iOS</text>

  <rect x="165" y="52" width="100" height="50" class="box box-client"/>
  <text x="215" y="72" class="title">Web SDK</text>
  <text x="215" y="86" class="sublabel">JS / Uniapp</text>

  <rect x="285" y="52" width="100" height="50" class="box box-client"/>
  <text x="335" y="72" class="title">Other SDKs</text>
  <text x="335" y="86" class="sublabel">Flutter / etc</text>

  <rect x="560" y="52" width="100" height="50" class="box box-client"/>
  <text x="610" y="72" class="title">后台管理</text>
  <text x="610" y="86" class="sublabel">Admin UI</text>

  <rect x="680" y="52" width="130" height="50" class="box box-client"/>
  <text x="745" y="72" class="title">第三方集成</text>
  <text x="745" y="86" class="sublabel">Webhook / Plugin</text>

  <!-- Layer 2: Gateway -->
  <rect x="20" y="125" width="880" height="85" class="layer"/>
  <text x="40" y="147" class="layer-title">GATEWAY LAYER</text>
  
  <rect x="280" y="155" width="360" height="45" class="box box-gateway"/>
  <text x="460" y="175" class="title">连接处理 wknet</text>
  <text x="460" y="189" class="sublabel">TCP  /  WebSocket  /  WSS</text>

  <!-- Layer 3: Core Server -->
  <rect x="20" y="220" width="880" height="180" class="layer"/>
  <text x="40" y="242" class="layer-title">CORE SERVICE LAYER</text>

  <rect x="70" y="285" width="120" height="50" class="box box-core"/>
  <text x="130" y="307" class="title">事件总线</text>
  <text x="130" y="321" class="sublabel">EventBus</text>

  <rect x="280" y="255" width="360" height="130" class="box box-core"/>
  <text x="460" y="278" class="title">核心逻辑 internal/server</text>
  <g fill="#64748b" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="10" text-anchor="middle">
    <text x="380" y="305">认证/授权</text>
    <text x="540" y="305">消息路由</text>
    <text x="380" y="330">用户管理</text>
    <text x="540" y="330">频道管理</text>
    <text x="380" y="355">连接管理</text>
    <text x="540" y="355">指令处理</text>
  </g>

  <rect x="720" y="255" width="120" height="55" class="box box-core"/>
  <text x="780" y="278" class="title">API 服务</text>
  <text x="780" y="293" class="sublabel">internal/api</text>

  <rect x="720" y="320" width="120" height="55" class="box box-core"/>
  <text x="780" y="343" class="title">外部集成</text>
  <text x="780" y="358" class="sublabel">Webhook / Plugin</text>

  <!-- Layer 4: Cluster -->
  <rect x="20" y="410" width="880" height="140" class="layer"/>
  <text x="40" y="432" class="layer-title">CLUSTER MANAGEMENT LAYER</text>

  <rect x="50" y="450" width="250" height="85" class="box box-cluster"/>
  <text x="175" y="472" class="title">节点管理 Node</text>
  <g fill="#64748b" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="10" text-anchor="middle">
    <text x="175" y="495">集群配置 (Raft)</text>
    <text x="175" y="512">节点发现 / 状态 / 事件同步</text>
  </g>

  <rect x="335" y="450" width="250" height="85" class="box box-cluster"/>
  <text x="460" y="472" class="title">槽管理 Slot</text>
  <g fill="#64748b" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="10" text-anchor="middle">
    <text x="460" y="495">元数据 (Raft)</text>
    <text x="460" y="512">频道配置 / 用户数据 / 分配迁移</text>
  </g>

  <rect x="620" y="450" width="250" height="85" class="box box-cluster"/>
  <text x="745" y="472" class="title">频道管理 Channel</text>
  <g fill="#64748b" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="10" text-anchor="middle">
    <text x="745" y="495">消息数据 (Raft)</text>
    <text x="745" y="512">消息存储 / 同步 / 频道元数据</text>
  </g>

  <!-- Layer 5: Storage -->
  <rect x="20" y="560" width="880" height="90" class="layer"/>
  <text x="40" y="582" class="layer-title">STORAGE LAYER</text>

  <rect x="280" y="590" width="360" height="50" class="box box-storage"/>
  <text x="460" y="612" class="title">分布式存储 wkdb</text>
  <text x="460" y="627" class="sublabel">基于 PebbleDB  ·  消息 / 用户 / Raft日志</text>

  <!-- Arrows: Clients -> Gateway -->
  <path d="M 95 102 Q 95 130 350 155" class="arrow"/>
  <path d="M 215 102 Q 215 130 400 155" class="arrow"/>
  <path d="M 335 102 Q 335 130 450 155" class="arrow"/>

  <!-- Admin -> API -->
  <path d="M 610 102 L 610 130 Q 610 140 700 140 L 780 140 L 780 255" class="arrow"/>

  <!-- Third Party -> External -->
  <path d="M 745 102 L 745 130 Q 745 140 850 140 L 850 347 L 840 347" class="arrow"/>

  <!-- Gateway -> Core -->
  <line x1="460" y1="200" x2="460" y2="255" class="arrow"/>

  <!-- Core -> EventBus -->
  <line x1="280" y1="310" x2="190" y2="310" class="arrow"/>

  <!-- API -> Core -->
  <line x1="720" y1="282" x2="640" y2="282" class="arrow"/>

  <!-- Core -> External -->
  <line x1="640" y1="347" x2="720" y2="347" class="arrow"/>

  <!-- Core -> Cluster -->
  <line x1="340" y1="385" x2="175" y2="450" class="arrow"/>
  <line x1="460" y1="385" x2="460" y2="450" class="arrow"/>
  <line x1="580" y1="385" x2="745" y2="450" class="arrow"/>

  <!-- Cluster interactions -->
  <line x1="300" y1="492" x2="335" y2="492" class="arrow-dash"/>
  <line x1="585" y1="492" x2="620" y2="492" class="arrow-dash"/>

  <!-- Cluster -> Storage -->
  <line x1="175" y1="535" x2="350" y2="590" class="arrow"/>
  <line x1="460" y1="535" x2="460" y2="590" class="arrow"/>
  <line x1="745" y1="535" x2="570" y2="590" class="arrow"/>

</svg>
